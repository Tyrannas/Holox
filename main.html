<!doctype html>
<style>
.blue {
    background-color: rgb(96, 148, 245);
    border-radius: 5px;
    padding: 3px;
}
.green {
    background-color: rgb(163, 245, 96);
    border-radius: 5px;
    padding: 3px;
}
</style>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title></title>
    <!-- stylesheets -->
    <link rel="stylesheet" href="treant-js-master/Treant.css" type="text/css"/>
</head>
<body>
    <div style="margin: auto;display: block; width: 40%;">
        <input type="text" id="userInput" style="width: 80%" value="Toto."/>
        <input type=button onclick="parseInput()" value="GO">
    </div>
    <p id="input" style="text-align: center;"></p>
    <div id="tree-simple"> </div>
    <!-- javascript -->
    <script src="treant-js-master/vendor/raphael.js"></script>
    <script src="treant-js-master/Treant.js"></script>
    <script src="parser.js"></script>
    <script src="lexer.js"></script>
    <script src="conf.js"></script>
    <script src="utils.js"></script>

    <script>
        var simple_chart_config = {
            chart: {
                container: "#tree-simple"
            },
            
            nodeStructure: {
                text: { name: "Root"},
                HTMLclass: "blue"
            }
        };
        var all_trees = []
        async function parseInput(){
                var input = document.getElementById('userInput').value
                var tokens = scan(tokenizer, input).map(el => el.type)
                console.log("TOKENS: \n", tokens)
                parseTokens(tokens, "texte", simple_chart_config.nodeStructure, grammar)
                // setLeafGreen(simple_chart_config.nodeStructure)
                // new Treant(simple_chart_config)
                let copy = {...simple_chart_config}
                for(let tree of all_trees){
                    copy.nodeStructure = JSON.parse(tree);
                    new Treant(copy)
                    await sleep(100)
                }
                setLeafGreen(simple_chart_config.nodeStructure)
                new Treant(simple_chart_config)
            }

        (async function () {
            const respGram = await fetch(HOST + "/" + GRAMMAR)
            const grammarRules = await respGram.text()
            
            const respLexems = await fetch(HOST + "/" + LEXEMS)
            const lexerRules = await respLexems.text()
            
            var tokenizer = buildTokenizer(lexerRules);
            var grammar = buildGrammar(grammarRules);
            
            console.log(grammar);
            console.log(tokenizer)

        })();

    </script>
</body>
</html>